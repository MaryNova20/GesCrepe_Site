<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core">

    <p:dialog widgetVar="dialogueExport" closable="false" closeOnEscape="true" 
              dynamic="false" modal="true"  header="Format du fichier" 
              showEffect="fold" hideEffect="puff">

        <h:form id="formulaireExport">
            <p:fieldset legend="Format">
                <p:selectOneRadio id="format" value="#{globalExportManagedBean.formatDocument}" 
                                  widgetVar="radioFormat">
                    <f:selectItems value="#{globalExportManagedBean.listeDesFormat}" var="courant"
                                   itemLabel="#{courant}" itemValue="#{courant}"/>
                </p:selectOneRadio>
            </p:fieldset>
            <div class="boutondiv">
                <p:commandButton value="Exporter" widgetVar="btnExport" 
                                 process="formulaireExport"
                                 action="#{globalExportManagedBean.exporter()}"
                                 update="@(.newAfficherPdf)"
            oncomplete="PF('dialogueExport').hide();afficherDlgExport();window.xhr = PrimeFaces.ajax.Queue.xhrs[0]"/>
                <p:commandButton value="Annuler" widgetVar="fermer" styleClass="fermerDlg" type="button"/>
            </div>
        </h:form>
    </p:dialog>
    <script type="text/javascript">
        $(function() {

            window.adresseReport = "http://" + window.location.host + "/GesCREPE/servlets/report/PDF";
            PF('fermer').getJQ().click(function() {
                PF('dialogueExport').hide();
            });
            PF('radioFormat').getJQ().on("change", function() {
                var base = "http://" + window.location.host + "/GesCREPE/servlets/report/";
                var sufix = PF('radioFormat').checkedRadio[0].parentNode.parentNode.
                        nextSibling.firstElementChild.textContent;

                window.adresseReport = base + sufix;
            });
        });

        function afficherDlgExport() {
            var typeFormat = PF('radioFormat').checkedRadio[0].parentNode.parentNode.
                    nextSibling.firstElementChild.textContent;
            if (typeFormat === "PDF") {
                PF('dialogueAfficherPdf').show();
            }
            else {
                window.open(window.adresseReport);
            }
        }

    </script>
</ui:composition>
